import dotenv from 'dotenv';
import { CovalentService } from './covalent-service';
import { Fetcher } from './fetcher';
import { Web3Provider } from './web3Provider';

dotenv.config();

const lockedStakesWallets = [
  '0xC0F470AceF7e535Fedb3e590d5f01EDE3Afb999c',
  '0xd7ED3F0ff6823e000e08E79C340697545c5925a3',
  '0xe8E18AF89BC4555748b891A2074F52B001942804',
  '0xE45a943F9B8B366042e58C69edF354023ac943e2',
  '0x9CDa9077484680d48f00994b0Db47d37D8727040',
  '0x9a2aa0c1156eC9f010548a9b2BfC33f692392b09',
  '0x99375d8c8F91DE6eFD20781c0c0cfeEDB4aeF709',
  '0x699e5Be1E3Cf7658410ED395593872554C4Ff806',
  '0x465BE2d56e2EDFcB7b03279f8C04082F0556ba75',
  '0x5b1f8f7BEd6A079d12D5dc6A20D9698c6038C1ee',
  '0xC8923742c3E9D2562dE9BEc5f194f3021be5BC67',
  '0x20BE7bc2cc357FeaB40CD8C29d9D9db8F85ab001',
  '0xeC70316567B83eF52713eDaA2610e370364A2e8F',
  '0x0B0eDf4CF347dE83d6E64d947edBbA9f164BcDdC',
  '0xcbBFa40F36F0Fda22f28BC25E43D52573D6826dB',
  '0x46286c55518Fca714946D22E7228fa26512F84a8',
  '0xbC9BffAEAEDd37781059ac9CaFddEb94C80B5836',
  '0xDf33Cf8651aEC39cEBf6C5f150766556353dF3E6',
  '0x959C277194061d866B5AC71040A7FF614c675C58',
  '0xdB4529b47281DdB8e2804071421c723A83D5fFcd',
  '0xa2af46Be6b202f2a4F22234531d7844f019DdC15',
  '0x2DdbB811F1b310EFc1D7C31b426F82d6dcF584f4',
  '0xCFE75F6F660627023BB89989078Fb10427D21D6C',
  '0x5BC9EbaDb32b4B241Ac45214AD9FCcD910F55f1E',
  '0x8c3FeCCBB7fcd932810858cAa015bE939f513b63',
  '0x9E87815365baec0238a959Aa883726D37388778B',
  '0xe72553260A27B1eA63957Fb0B2c227b2733000BE',
  '0xc175D5AD51AaCf66Aa09Efa8257A216ee7E0de05',
  '0x4Ca0F335029187dD432395a53c2f4CFed45f34d4',
  '0x5378E749d3C7F7507bb6CD40d4b4A4e806e5aF35',
  '0x65b1343e455a35F6707815149239db788928B7Ab',
  '0x4140100f2229122245E981c3874ba29CC183c8Dc',
  '0xC56eFc8426D956C5849071975888562b058E1C7f',
  '0x77Dc850E39b97a94EB4d29d039730217285f0F77',
  '0x3BFA3222b46318361649A3f35F624A6fe6C46571',
  '0x10Eb4E9657c1502A2f6C593f0Ca6910F4C585bC8',
  '0xa1de30e1Ac507791D0E8519C160b8fcc17CFB028',
  '0x106dd185aA663B882096d169551A01ac74735476',
  '0xC82B77008EC2DFab6Cd7Cc3823BF74649b3eae09',
  '0xf8B79ae59EC5dDD26ca3D3f195B8F5b4EE08a361',
  '0x3FCB9329b6408AfDAB9C463705Aa44Cd68fC1c0D',
  '0x92c3e79c4e5D83F125D4163089304e37bB3cd52F',
  '0xCb608A4D070b7eE694C471fc65717B97838dFcb3',
  '0x77C53F895C1250Dc8Ffe29BE2291Cc85F72bc70e',
  '0xB664fe599eBC25cB5a1BaF4C266f73e97578e7BC',
  '0xB24293f00f490e027990Ebb849Ec4b35BDe13013',
  '0x9f8bc591C101914536Cea00341f07802FB61aFD8',
  '0xAD7319A4B687DfA1eFfc723261a4Dc0b1590FA40',
  '0xd79Df9dfdAAFb194D4A9f1536aF5A7A3b37eD8F8',
  '0x84e6b1db8b5644EB46C316Ea39Da35BE9fC0a4af',
  '0x5CF6a31603EBce6cB3d2f483982AdcC1716f40e2',
  '0x4a389dC38dA75D422FD3e031B1B7c8243fCAd035',
  '0xeEc9fdb5cC37D6cf8621ea4FdAC6d3Ec4184D32B',
  '0xc3A8A41f5F7C542DF32227A9bDdacf3A4617Afa3',
  '0xD9bCF3F199631817391b953c08F366DFb3D8D88c',
  '0xf12c0c8BCCF690C9248f4BDa0A39132d84976E07',
  '0x8eB354f1CBb0AB7ef0D038883b4c1065e008453F',
  '0x646AfA29132b7E623348806Fe7ec063F3267E214',
  '0x7F597FeC9642122F13a5Ad440609d5334Bd4db92',
  '0xF1B6106ea7894e2A51886EB2cFf6389f8ad5208b',
  '0xBa63309d94B4CB4436F495b34c02994c953bfFe1',
  '0xF7ead8eCbeE516A47D248472B0Db47F69BCBFebC',
  '0xa51Fa51788DE0BC5B534AB4CBa23f0329Ec5512c',
  '0xABD47786500d0DEe68340e1CdE360AAe772F348C',
  '0x2EB7E3390B63cf207f20299596Cf21eA47b90812',
  '0x85B2657aF7767f56C2E00F4Ec2D4E496673303a5',
  '0x3657d9aAA6C3334Ce926e8e05b70ad7eD6328A06',
  '0xc1D1Cc2aDD1a2aE568080E36655a3cAD4BA101D0',
  '0x29de6A8a0FA4d38A3b5288c6e13cB0a64f348514',
  '0x0CAEfe8E889530b2ba3EB95DB23e3bD714957015',
  '0x48b47829Dad91cFf40D6cB6a2262B9cF5Cdb4CC8',
  '0xeCb7E6F3B6D3ba068CEF7C79b73629Af79eA6f40',
  '0x2f9c38bD6E2F382C031bfda65aeA2b76BEcD6808',
  '0x3401433149C54839DF7C1dFc3E798AE4E167F8CC',
  '0xbbd46907123749e79Ea93cb86ea856e5CdA80899',
  '0xF2467EF39bF7293BDa0AA3b7111f8cAb57bd2fC7',
  '0x98173f2AfB33B3e51832cF9827C532FdFB0855E0',
  '0xeA93C936b9e1B2B75d421Bf7c45D99a502eB539e',
  '0x07c84BC8c7ab3D8BD8E76cF34dDA550028321E76',
  '0x3EfCB29F6d748AAE679A2D0a4D41E5457A96D9EC',
  '0x60Cc569cba0090eC03D08E0C9eA9aa2612007f18',
  '0x4A4651320346a136E7573B1fafAD09fDA848b9Ff',
  '0x03A8491d44149F60B045b020bC3589754aDD6Eba',
  '0x799c25259A662A29b60e456eEF9F7a5812052a2c',
  '0x13Fd884236e749Ba60391082f57bE98623A4F11b',
  '0x2CdF3022B951007eaC83294781793ffF6ac6aaF8',
  '0x5488ad7A97EECa612D73e395442ec60790B4a788',
  '0x8b2d14B7853607BBCcf679F3a743A3995779Ad49',
  '0x3146855F5dB4612E8228eC4c72983c757ED50854',
  '0xA4087a030417f6c29B3d465360fB8615ae517d36',
  '0x6cC133DF47149F3C714c3a8C42a979e582e6b839',
  '0x699C79f10d0751B440c0Fd8615B80073010b3c9E',
  '0x79482013723BB6b40F7B9D0B97B1988Db1F145B8',
  '0xa2E5Dbd496e25A194a11FC3e4Ad5AdA199e827F4',
  '0x923Ed1DD442C5CdAB1109931affd1a8510Ac6110',
  '0x6B6F71EC9e804524D14b0Db51E133362DB3137C2',
  '0xC73cA270e6613ce58441a75f3853F0cF1b269b58',
  '0x2780eA09c5846c14899daBf85166DB23B6f85A51',
  '0x52cE6083fBa85D7c028fe0e5F0BccAeEaa3353a2',
  '0x5B395b4253915263E9810d4ED80e08b261622c28',
  '0xcbebCF4fd59E082d8F95F8C9a7D2585C3229DA84',
  '0x444e651f977318146727974E22A2fca632A6FE8A',
  '0xC857a07Ca20babEdA3f76E9Be6B1B2701A29fC11',
  '0x7AE33a7D63146081c84F209611D45F3AD5Dcb809',
  '0x1ce8b7878e7f1216Af8d0B50259F194b88F1057F',
  '0x338aFC94D49b40dfBB75A53534a71D6464bF3145',
  '0x8d80598D04c58ed0241C1EB564eDc2D1dB81Bf9a',
  '0x01405d4DeC6cA4C8CCe38A13375640D3B764F08d',
  '0x36eCBE947115ede61A66b3cfcFB659097db3927c',
  '0xaD0DE1962ab903E06C725A1b343b7E8950a0Ff82',
  '0x86fA98Aa6C7E174f615556a1ecAa1b93E5101A7E',
  '0x20B455EA266a0ba697bc7D0181B90011AD10CA20',
  '0xEeFEa3f1a119570DA3f2da09DBc2E5f0FC1b8f56',
  '0x15D5865de165221f3b478508668aD539DEE7bA3a',
  '0x9a50A078d80F36E38EDfAE85AfFa2B8aB458e2C9',
  '0xCCa1D6fD085bD7dF99D06f67f54b183C18471a08',
  '0x23bA92f05Df50D1f0AE207f763dd06B32aA4335B',
  '0x193e334dC465eA3eC931d2fd33f84d7551258a43',
  '0xCEDA4D72Fe7d8418A8357730AAb8b680a490850d',
  '0x078180F8A57d14eb7b3308Ff6d6872ED56e1E708',
  '0x5C9a1FBF25c77269502443F6442AD35E0Fdd2d76',
  '0xC3836599dE06bC821Ce9b99Ab30CaE1b426760EA',
  '0x81A743E669E7150826597380C8433cEE294b43D8',
  '0x5228DED1255A913F39BA5D4C64760e145F8abE2C',
  '0xc71816b582D92C1da79C85f61466BE33b137e622',
  '0x9BDbdb4A8f7f816C87a67F5281484ED902C6b942',
  '0x5386E18362c86c8451277d6F886C10946b387e8E',
  '0x3a75165c4b9b879a77b93D4b6cB57bD9b15a562a',
  '0xb28F260d8A63d5D18e4079A77DEEAc0fFCC1Ec02',
  '0xD26c8d1aEbD5398c52bf0182C8Cd01c3Cc186C4a',
  '0x65d189e839aF28B78567bD7255f3f796495141bc',
  '0x0d1F09C4426cd1520976F425295991c68A51B817',
  '0x18752e60de6FBff6aeA68E1176E80f7d0B5Fa81D',
  '0x0C4fb81A6C692D2Ad0CeEA8b82fDcec47d4c3379',
  '0x598067A2a727837141E1A42809dC1Ff14d99946d',
  '0xAFE46aF83f9a749E3c96029472946b197034f829',
  '0x46242D6D3Ef7b1f0BCBd24A9aeE261d0E3DEc0a4',
  '0x662E4a5E380C65999894b2b3AD3233e5726A26b0',
  '0x7B32eF71aca2bE08b2ea5514F6593D96FcBfFC69',
  '0x3430A863E332A9200768701061776575bdF6Ba1E',
  '0x18bc35c3B74b35C70CFF0EC14AD62f4A8c2e679C',
  '0xCF34Be11F88Eb882b104E14265670a1DAf993213',
  '0x7217bAB7533670005942D9Af3D7bCDDf466b2E83'
];

async function main() {
  validateEnvVars();

  const rpcEndpoint = process.env.RPC_ENDPOINT!;
  const web3provider = new Web3Provider(rpcEndpoint);

  const covalentApiKey = process.env.COVALENTHQ_API_KEY!;
  const covalentService = new CovalentService(covalentApiKey);
  const bdxInWalletBalances = await covalentService.getBdxWalletHoldings();

  console.log(`BDX in ${Object.keys(bdxInWalletBalances).length} wallets: ${JSON.stringify(bdxInWalletBalances)}`);

  const allWallets = Array.from(
    new Set([...lockedStakesWallets.map(addr => addr.toLowerCase()), ...Object.keys(bdxInWalletBalances).map(addr => addr.toLowerCase())])
  );

  const fetcher = new Fetcher(web3provider, allWallets, bdxInWalletBalances);
  await fetcher.printTotalHoldings();
}

function validateEnvVars(): void {
  if (!process.env.RPC_ENDPOINT) {
    throw new Error('RPC_ENDPOINT is missing');
  }

  if (!process.env.COVALENTHQ_API_KEY) {
    throw new Error('COVALENTHQ_API_KEY is missing');
  }
}

main();
